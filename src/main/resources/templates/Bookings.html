<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Bookings</title>
    <link rel="icon" type="image/png" href="/images/icons/EVERout_Logo_hell_v3.png">
    <!-- Bootstrap CSS and JS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" defer></script>
    <link rel="stylesheet" href="/css/navbar.css">
    <link rel="stylesheet" href="/css/bookingList.css">
    <link rel="stylesheet" href="/css/toast.css">
</head>
<body>

<div id="toastContainer" class="toast-container"></div>

<!-- Navigation Bar -->
<div id="navbar">
    <ul>
        <li class="navbarLeft"><a href="/homepage"><img class="logo" src="/images/icons/EVERout_Logo_dunkel_v3.png" alt="Home button"></a></li>
        <li class="navbarLeft"><a class="links" href="/events">EVENTS</a></li>
        <li class="navbarLeft"><a class="links" href="/bookings">BOOKINGS</a></li>
        <li class="navbarLeft" id="adminNav" style="display: none;"><a class="links" href="/admin">ADMIN</a></li>
        <li class="navbarRight" id= "loggedOutContainer"><a href="/user"><img id="loggedOutProfile" src="/images/icons/Profile.png" alt="profile-account"></a></li>
        <li class="navbarRight dropdown" id="loggedInContainer" style="display: none;">
            <a class="d-flex align-items-center text-decoration-none dropdown-toggle" href="#" id="profileDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                <div id="loggedInProfile" class="profile-circle"></div>
            </a>
            <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="profileDropdown">
                <li><span class="dropdown-item-text" id="userNameDisplay"></span></li>
                <li><hr class="dropdown-divider"></li>
                <li><button class="dropdown-item" id="logout" onclick="logout()">Sign out</button></li>
            </ul>
        </li>
        <li class="navbarRight"><a><img id="cart" src="/images/icons/shoppingCart.png" alt="cart"></a></li>
        <li class="navbarRight"><a><img id="favorites" src="/images/icons/favorites.png" alt="favorites"></a></li>
    </ul>
</div>

<!-- Search Section -->
<div class="container mt-4">
    <div class="search-wrapper">
        <div class="search-container">
            <svg class="search-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="11" cy="11" r="8"></circle>
                <path d="m21 21-4.35-4.35"></path>
            </svg>
            <input
                    type="text"
                    id="searchInput"
                    class="search-input"
                    placeholder="Search bookings by name, email..."
                    onkeyup="filterBookings()">
            <span id="searchCount" class="search-count"></span>
        </div>

        <!-- Filter Checkbox -->
        <div class="filter-controls mt-3 text-center">
            <div class="form-check form-check-inline">
                <input class="form-check-input" type="checkbox" id="hideCancelledCheckbox" onchange="filterBookings()">
                <label class="form-check-label" for="hideCancelledCheckbox">
                    Hide cancelled bookings
                </label>
            </div>
        </div>
    </div>
</div>

<!-- Bookings List Container -->
<div class="container mt-4" id="bookingsWrapper">
    <div id="bookingsContainer"></div>

    <div id="noResults" class="no-results" style="display: none;">
        <div class="no-results-icon">üîç</div>
        <h3>No bookings found</h3>
        <p>Try adjusting your search terms</p>
    </div>
</div>

<!-- Template for booking card -->
<template id="bookingCardTemplate">
    <div class="card mb-3 shadow-sm clickable-card booking-card">
        <div class="row g-0 align-items-center">
            <div class="col-md-10">
                <div class="card-body">
                    <h5 class="card-title"></h5>
                    <p class="card-text mb-1"><strong>Name:</strong> <span class="card-name"></span></p>
                    <p class="card-text mb-1"><strong>Email:</strong> <span class="card-email"></span></p>
                    <p class="card-text mb-1"><strong>Booking Date:</strong> <span class="card-date"></span></p>
                    <p class="card-text"><small class="card-status badge"></small></p>
                </div>
            </div>
            <div class="col-md-2 d-flex justify-content-end align-items-center">
                <div class="card-details-section">
                    <button type="button" class="btn btn-outline-primary btn-sm btn-open-details">View Details</button>
                </div>
            </div>
        </div>
    </div>
</template>

<!-- Template for booking details modal -->
<template id="detailsModalTemplate">
    <div class="modal mt-3" tabindex="-1">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Booking Details</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6 booking-section">
                            <h6 class="text-muted mb-4">PERSONAL INFORMATION</h6>
                            <div class="info-row">
                                <span class="info-label">Full Name:</span>
                                <span class="info-value d-name"></span>
                            </div>
                            <div class="info-row">
                                <span class="info-label">Birth Date:</span>
                                <span class="info-value d-birthdate"></span>
                            </div>
                            <div class="info-row">
                                <span class="info-label">Email:</span>
                                <span class="info-value d-email"></span>
                            </div>
                            <div class="info-row">
                                <span class="info-label">Phone:</span>
                                <span class="info-value d-phone"></span>
                            </div>
                            <div class="info-row">
                                <span class="info-label">Address:</span>
                                <span class="info-value d-address"></span>
                            </div>
                        </div>
                        <div class="col-md-6 booking-section">
                            <h6 class="text-muted mb-4">BOOKING INFORMATION</h6>
                            <div class="info-row">
                                <span class="info-label">Booking Date:</span>
                                <span class="info-value d-bookingdate"></span>
                            </div>
                            <div class="info-row">
                                <span class="info-label">Event Name:</span>
                                <span class="info-value d-eventname">-</span>
                            </div>
                            <div class="info-row">
                                <span class="info-label">Event Location:</span>
                                <span class="info-value d-eventlocation">-</span>
                            </div>
                            <div class="info-row">
                                <span class="info-label">Price:</span>
                                <span class="info-value d-eventprice">-</span>
                            </div>
                            <div class="info-row">
                                <span class="info-label">Status:</span>
                                <span class="d-status badge"></span>
                            </div>
                            <div class="d-cancelDeadline info-row">
                                <span class="info-label">Cancellation Deadline:</span>
                                <span class="info-value"></span>
                            </div>
                            <div class="d-cancelReason info-row" style="display:none;">
                                <span class="info-label">Cancellation Reason:</span>
                                <span class="info-value"></span>
                            </div>
                            <div class="d-cancelDate info-row" style="display:none;">
                                <span class="info-label">Cancellation Date:</span>
                                <span class="info-value"></span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer d-flex justify-content-between">
                    <div class="cancel-section text-end">
                    <button type="button" class="btn btn-outline-danger btn-open-cancel">Cancel Booking</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</template>

<template id="cancelModalTemplate">
    <div class="modal fade" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <form class="cancel-form">
                    <div class="modal-header">
                        <h5 class="modal-title">Cancel Booking</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <p>Please provide a reason for cancellation:</p>
                        <textarea name="cancellationReason" class="form-control cancellationReason" rows="3" required></textarea>
                    </div>
                    <div>
                        <span id="calculateRefund">

                        </span>
                    </div>
                    <div class="modal-footer">
                        <button type="submit" class="btn btn-danger">Confirm</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</template>

<script src="/js/loginUserIcon.js"></script>
<script src="/js/toast.js"></script>
<script src="/js/bookingApi.js"></script>

</body>
</html>